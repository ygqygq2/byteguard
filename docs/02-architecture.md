# ByteGuard æ¶æ„è®¾è®¡

## ğŸ—ï¸ æ•´ä½“æ¶æ„

ByteGuard é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼ŒèŒè´£æ¸…æ™°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ByteGuard ç”Ÿæ€ç³»ç»Ÿ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  byteguard (å…¬å¼€ä»“åº“) - æ ¸å¿ƒåŠ å¯†å¼•æ“              â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ byteguard-core:    åŠ å¯†/è§£å¯†ç®—æ³•              â”‚ â”‚
â”‚  â”‚  â€¢ byteguard-cli:     CLI å·¥å…· + JavaAgent      â”‚ â”‚
â”‚  â”‚  â€¢ byteguard-maven-plugin: Maven é›†æˆ           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚ (ä½¿ç”¨)                            â”‚
â”‚                    â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  byteguard-website (ç§æœ‰) - åœ¨çº¿åŠ å¯†æœåŠ¡         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ JAR æ–‡ä»¶ä¸Šä¼ åŠ å¯†                              â”‚ â”‚
â”‚  â”‚  â€¢ Agent.jar ä¸‹è½½æœåŠ¡                            â”‚ â”‚
â”‚  â”‚  â€¢ ç”¨æˆ·ç®¡ç†å’Œè®¢å•ç³»ç»Ÿ                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  byteguard-license-server (ç§æœ‰) - License ç®¡ç†  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ GPG License ç”Ÿæˆ                              â”‚ â”‚
â”‚  â”‚  â€¢ License éªŒè¯ API                              â”‚ â”‚
â”‚  â”‚  â€¢ ç®¡ç†åå°                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  byteguard-pro (ç§æœ‰) - ä¼ä¸šå¢å¼ºåŠŸèƒ½             â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ åè°ƒè¯•æ£€æµ‹                                    â”‚ â”‚
â”‚  â”‚  â€¢ é«˜çº§ä»£ç æ··æ·†                                  â”‚ â”‚
â”‚  â”‚  â€¢ è¿è¡Œæ—¶å®Œæ•´æ€§æ£€æŸ¥                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŒè´£åˆ’åˆ†

| æ¨¡å— | ç±»å‹ | èŒè´£ |
|------|------|------|
| **byteguard** | å¼€æº | æ ¸å¿ƒåŠ å¯†å¼•æ“ï¼ˆAES-256-GCM + PBKDF2ï¼‰ |
| **byteguard-website** | ç§æœ‰ | åœ¨çº¿æœåŠ¡ï¼ˆä½¿ç”¨ byteguard ä½œä¸ºåº•å±‚ï¼‰ |
| **byteguard-license-server** | ç§æœ‰ | License ç®¡ç†å’ŒéªŒè¯ |
| **byteguard-pro** | ç§æœ‰ | ä¼ä¸šçº§å®‰å…¨å¢å¼º |

## ğŸ” ByteGuard Core æ¶æ„

æ ¸å¿ƒåŠ å¯†å¼•æ“çš„å†…éƒ¨è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ByteGuard Core (Open Source)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   CLI Tool   â”‚      â”‚ Maven Plugin â”‚                     â”‚
â”‚  â”‚ (Encryptor)  â”‚      â”‚ (Build Tool) â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                     â”‚                               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                               â”‚                               â”‚
â”‚                               â–¼                               â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                  â”‚   byteguard-core     â”‚                    â”‚
â”‚                  â”‚  - AES-256-GCM       â”‚                    â”‚
â”‚                  â”‚  - PBKDF2 + HKDF     â”‚                    â”‚
â”‚                  â”‚  - Class Encryptor   â”‚                    â”‚
â”‚                  â”‚  - Class Decryptor   â”‚                    â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                             â”‚                                 â”‚
â”‚                             â–¼                                 â”‚
â”‚                  [Encrypted JAR + Metadata]                  â”‚
â”‚                             â”‚                                 â”‚
â”‚                             â–¼                                 â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                  â”‚   JavaAgent          â”‚                    â”‚
â”‚                  â”‚  - Password Auth     â”‚                    â”‚
â”‚                  â”‚  - ClassTransformer  â”‚                    â”‚
â”‚                  â”‚  - AES Decryptor     â”‚                    â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

> **ğŸš€ æƒ³è¦æ›´å¤šä¼ä¸šçº§ä¿æŠ¤ï¼Ÿ**  
> ByteGuard Pro æä¾›ï¼š**GPG æ•°å­—ç­¾åéªŒè¯**ã€**ç¡¬ä»¶ç»‘å®šæˆæƒ**ã€**åœ¨çº¿ License ç®¡ç†å¹³å°**ã€**åè°ƒè¯•ä¿æŠ¤**ã€**ä»£ç æ··æ·†**ã€**è¿è¡Œæ—¶å®Œæ•´æ€§æ£€æŸ¥**ç­‰é«˜çº§åŠŸèƒ½ã€‚  
> è¯¦æƒ…è¯·è®¿é—®ï¼š[https://byteguard-pro.ygqygq2.com](https://byteguard-pro.ygqygq2.com)
```

## ğŸ” åŠ å¯†æµç¨‹

### 1. å¯†é’¥æ´¾ç”Ÿï¼ˆKey Derivationï¼‰

```
User Password
     â”‚
     â–¼
PBKDF2 (100,000 iterations, SHA-256)
     â”‚
     â”œâ”€â”€â”€ Random Salt (32 bytes)
     â”‚
     â–¼
Master Key (32 bytes)
     â”‚
     â”œâ”€â”€â”€ HKDF-Expand
     â”‚    â””â”€â”€â”€ Context: className
     â”‚
     â–¼
Per-Class Key (32 bytes)
```

**è®¾è®¡ç†å¿µ**ï¼š
- **PBKDF2**ï¼šæŠµå¾¡æš´åŠ›ç ´è§£ï¼ˆ100k è¿­ä»£ï¼‰
- **HKDF**ï¼šæ¯ä¸ªç±»ä½¿ç”¨ç‹¬ç«‹å¯†é’¥ï¼Œå³ä½¿ä¸€ä¸ªç±»è¢«ç ´è§£ä¹Ÿä¸å½±å“å…¶ä»–ç±»
- **Random Salt**ï¼šæ¯ä¸ª JAR å”¯ä¸€ï¼Œé˜²æ­¢é¢„è®¡ç®—æ”»å‡»

### 2. ç±»åŠ å¯†ï¼ˆClass Encryptionï¼‰

```java
for (ClassFile class : jar.classes) {
    // 1. æ´¾ç”Ÿç±»ä¸“å±å¯†é’¥
    byte[] classKey = HKDF.expand(masterKey, class.name);
    
    // 2. AES-256-GCM åŠ å¯†
    byte[] iv = SecureRandom.generateIV(12);  // 12 bytes
    byte[] encrypted = AES_GCM.encrypt(
        plaintext: class.bytecode,
        key: classKey,
        iv: iv,
        aad: class.name  // Additional Authenticated Data
    );
    
    // 3. å­˜å‚¨æ ¼å¼
    output = iv + encrypted + authTag;  // 12 + N + 16 bytes
}
```

**GCM æ¨¡å¼ä¼˜åŠ¿**ï¼š
- âœ… è®¤è¯åŠ å¯†ï¼ˆAEADï¼‰ï¼šåŒæ—¶ä¿è¯ä¿å¯†æ€§å’Œå®Œæ•´æ€§
- âœ… é˜²ç¯¡æ”¹ï¼šä»»ä½•ä¿®æ”¹éƒ½ä¼šå¯¼è‡´è®¤è¯å¤±è´¥
- âœ… æ€§èƒ½ä¼˜ç§€ï¼šç¡¬ä»¶åŠ é€Ÿï¼ˆAES-NIï¼‰

### 3. å…ƒæ•°æ®ç”Ÿæˆ

åŠ å¯†åçš„ JAR ç»“æ„ï¼š

```
encrypted-app.jar
â”œâ”€â”€ META-INF/
â”‚   â”œâ”€â”€ MANIFEST.MF
â”‚   â”œâ”€â”€ byteguard-metadata.json      # åŠ å¯†å…ƒæ•°æ®
â”‚   â””â”€â”€ .encrypted/
â”‚       â”œâ”€â”€ com.example.Main         # åŠ å¯†åçš„ç±»ï¼ˆäºŒè¿›åˆ¶ï¼‰
â”‚       â”œâ”€â”€ com.example.Service
â”‚       â””â”€â”€ ...
â”œâ”€â”€ static/                           # æœªåŠ å¯†èµ„æº
â”œâ”€â”€ application.yml
â””â”€â”€ lib/                              # ä¾èµ– JARï¼ˆæœªåŠ å¯†ï¼‰
```

`byteguard-metadata.json` ç¤ºä¾‹ï¼š

```json
{
  "version": "1.0",
  "algorithm": "AES-256-GCM",
  "salt": "base64EncodedSalt==",
  "encryptedAt": 1705593600000,
  "totalClasses": 42
}
```

## ğŸš€ è¿è¡Œæ—¶è§£å¯†

### JavaAgent åŠ è½½æµç¨‹

```
JVM Startup
     â”‚
     â–¼
1. JavaAgent.premain()
     â”‚
     â”œâ”€â”€â”€ Load license.lic
     â”œâ”€â”€â”€ Verify GPG signature
     â”œâ”€â”€â”€ Parse metadata
     â””â”€â”€â”€ Derive master key
     â”‚
     â–¼
2. Register ClassFileTransformer
     â”‚
     â–¼
3. JVM loads class "com.example.Main"
     â”‚
     â–¼
4. ByteGuardTransformer.transform()
     â”‚
     â”œâ”€â”€â”€ Read encrypted bytes from JAR
     â”œâ”€â”€â”€ Derive class key (HKDF)
     â”œâ”€â”€â”€ Decrypt with AES-GCM
     â””â”€â”€â”€ Return plaintext bytecode
     â”‚
     â–¼
5. JVM defines class normally
     â”‚
     â–¼
Application runs
```

### ClassFileTransformer å®ç°

```java
public class ByteGuardTransformer implements ClassFileTransformer {
    
    @Override
    public byte[] transform(ClassLoader loader, String className,
                           Class<?> classBeingRedefined,
                           ProtectionDomain protectionDomain,
                           byte[] classfileBuffer) {
        
        // 1. æ£€æŸ¥æ˜¯å¦éœ€è¦è§£å¯†
        if (!encryptedClasses.containsKey(className)) {
            return null;  // ä¸å¤„ç†
        }
        
        // 2. è¯»å–åŠ å¯†æ•°æ®
        byte[] encrypted = readEncryptedClass(className);
        
        // 3. è§£å¯†
        byte[] decrypted = decryptor.decrypt(className, encrypted);
        
        // 4. è¿”å›åŸå§‹å­—èŠ‚ç 
        return decrypted;
    }
}
```

##  æ€§èƒ½ä¼˜åŒ–

### å¯åŠ¨æ—¶é—´ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | æ•ˆæœ | å®ç° |
|--------|------|------|
| Lazy è§£å¯† | æŒ‰éœ€è§£å¯†ï¼Œä¸é¢„åŠ è½½ | ClassFileTransformer |
| ä¸»å¯†é’¥ç¼“å­˜ | ä»…æ´¾ç”Ÿä¸€æ¬¡ | é™æ€å˜é‡ |
| å…ƒæ•°æ®é¢„è¯» | é¿å…å¤šæ¬¡è¯» JAR | å¯åŠ¨æ—¶åŠ è½½ |
| ç¡¬ä»¶åŠ é€Ÿ | AES-NI æŒ‡ä»¤é›† | JDK å†…ç½® |

**åŸºå‡†æµ‹è¯•ç»“æœ**ï¼ˆ100 ä¸ªç±»ï¼‰ï¼š

- é¦–æ¬¡å¯åŠ¨ï¼š~150ms overhead
- åç»­ç±»åŠ è½½ï¼š~2ms per class
- æ€»è®¡ï¼š< 200msï¼ˆå°å‹åº”ç”¨ï¼‰

### å†…å­˜ä¼˜åŒ–

- âŒ **ä¸ç¼“å­˜è§£å¯†åçš„ç±»**ï¼šé¿å…å†…å­˜æ³„æ¼
- âœ… **ä»…ç¼“å­˜å…ƒæ•°æ®**ï¼š< 1MB
- âœ… **æµå¼å¤„ç†**ï¼šä¸åŠ è½½æ•´ä¸ª JAR åˆ°å†…å­˜

## ğŸ” å®‰å…¨åˆ†æ

### æ”»å‡»é¢åˆ†æ

| æ”»å‡»ç±»å‹ | é˜²æŠ¤æªæ–½ | å®‰å…¨ç­‰çº§ |
|----------|----------|----------|
| é™æ€åç¼–è¯‘ | ç±»æ–‡ä»¶åŠ å¯† | âœ… é«˜ |
| å†…å­˜ Dump | ä»…è¿è¡Œæ—¶å­˜åœ¨æ˜æ–‡ | âš ï¸ ä¸­ |
| è°ƒè¯•å™¨é™„åŠ  | ï¼ˆProï¼šåè°ƒè¯•ï¼‰ | âš ï¸ ä¸­ |
| JAR ç¯¡æ”¹ | å…ƒæ•°æ®æ ¡éªŒ | âš ï¸ ä¸­ |
| å¯†ç çˆ†ç ´ | PBKDF2 100k è¿­ä»£ | âœ… é«˜ |

### å¨èƒæ¨¡å‹

**å·²é˜²å¾¡**ï¼š
- âœ… JAR åç¼–è¯‘å·¥å…·ï¼ˆJD-GUI, Fernflowerï¼‰
- âœ… ç¦»çº¿æš´åŠ›ç ´è§£ï¼ˆæ—¶é—´æˆæœ¬é«˜ï¼‰
- âœ… å¯†é’¥æ´¾ç”Ÿå®‰å…¨ï¼ˆPBKDF2 + HKDFï¼‰

**Pro ç‰ˆæœ¬å¢å¼º**ï¼š
- ğŸ”’ GPG License éªŒè¯
- ğŸ”’ æœºå™¨ç»‘å®šï¼ˆCPU/ä¸»æ¿åºåˆ—å·ï¼‰
- ğŸ”’ è¿è¡Œæ—¶å†…å­˜ä¿æŠ¤
- ğŸ”’ åè°ƒè¯•æ£€æµ‹
- ğŸ”’ ä»£ç æ··æ·†
- ğŸ”’ å®Œæ•´æ€§è‡ªæ£€

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](01-quick-start.md)
- [API å‚è€ƒ](03-api-reference.md)
- [æµ‹è¯•æŒ‡å—](04-testing.md)
